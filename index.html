<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pension Calculator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="A free UK Pension Calculator to help you estimate retirement savings, workplace pensions, ISAs and growth. No login or data collection."
    />
    <meta
      name="keywords"
      content="UK pension calculator, retirement calculator UK, pension estimator, workplace pension savings, future pension pot calculator"
    />

    <!-- Correct external CSS include -->
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <!-- TOP NAV MENU -->
    <nav class="top-nav">
      <div class="nav-container">
        <ul class="nav-menu">
          <li><a href="index.html">Home</a></li>
          <li><a href="aboutus.html">About Us</a></li>
          <li><a href="privacy.html">Privacy</a></li>
          <li><a href="index.html">More Tools</a></li>
        </ul>
      </div>
    </nav>

    <div class="wrap">
      <header>
        <div class="logo">PC</div>
        <div>
          <h1>Pension Calculator</h1>
          <p class="lead">
            Simple projections for Retirement, ISA and SIPP. Choose to add a
            partner and combine totals.
          </p>
        </div>
      </header>

      <div id="root"></div>
    </div>

    <!-- React + Babel -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState } = React;

      function toNum(v) {
        const n = parseFloat(String(v).replace(/,/g, ""));
        return Number.isFinite(n) ? n : 0;
      }

      function fvLump(initial, rate, years) {
        return initial * Math.pow(1 + rate, years);
      }

      function fvSeries(annualContribution, rate, years) {
        if (years <= 0) return 0;
        if (rate === 0) return annualContribution * years;
        return (annualContribution * (Math.pow(1 + rate, years) - 1)) / rate;
      }

      function calculatePerson(person, rates) {
        const currentAge = toNum(person.currentAge);
        const retirementAge = toNum(person.retirementAge);
        const yearsUntilRetirement = Math.max(
          0,
          Math.floor(retirementAge - currentAge)
        );
        const expenseYears = toNum(person.retirementExpenseYears);
        const monthlyExpense = toNum(person.retirementMonthlyExpense);
        const totalRetirementExpense = monthlyExpense * 12 * expenseYears;

        const results = rates.map((r) => {
          const retirementFV =
            fvLump(toNum(person.retirement.initial), r, yearsUntilRetirement) +
            fvSeries(toNum(person.retirement.annual), r, yearsUntilRetirement);
          const isaFV =
            fvLump(toNum(person.isa.initial), r, yearsUntilRetirement) +
            fvSeries(toNum(person.isa.annual), r, yearsUntilRetirement);
          const sippFV =
            fvLump(toNum(person.sipp.initial), r, yearsUntilRetirement) +
            fvSeries(toNum(person.sipp.annual), r, yearsUntilRetirement);
          const total = retirementFV + isaFV + sippFV;
          const leftOver = total - totalRetirementExpense;
          return {
            rate: r,
            retirementFV,
            isaFV,
            sippFV,
            total,
            totalRetirementExpense,
            leftOver,
            expenseYears,
            monthlyExpense,
          };
        });
        return { years: yearsUntilRetirement, results };
      }

      function Money({ value }) {
        return (value || 0).toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      }

      const emptyPerson = {
        currentAge: "",
        retirementAge: "",
        retirementMonthlyExpense: "",
        retirementExpenseYears: "",
        retirement: { initial: "", annual: "" },
        isa: { initial: "", annual: "" },
        sipp: { initial: "", annual: "" },
      };

      // --- BOLD STATE PENSION NOTE CONTENT: update here as needed ---
      const StatePensionNote = () => (
        <div className="bold-note">
          <p>UK State Pension</p>
          <ul>
            <li>From age 67, you may receive the UK State Pension.</li>

            <li>The full pension is £230.25/week (April 2025–March 2026).</li>

            <li>
              {" "}
              You need at least 10 qualifying years to get anything, and 35
              years for the full amount. Less than 35 years gives a
              proportionally reduced pension.
            </li>

            <li>The State Pension age is currently 66 (as of 2025).</li>
          </ul>
        </div>
      );

      function PersonForm({ title, person, onChange, onCalculate, results }) {
        const setField = (path, value) => {
          const next = JSON.parse(JSON.stringify(person));
          const keys = path.split(".");
          let cur = next;
          while (keys.length > 1) {
            cur = cur[keys.shift()];
          }
          cur[keys[0]] = value;
          onChange(next);
        };

        const showYears =
          person.currentAge &&
          person.retirementAge &&
          toNum(person.retirementAge) > toNum(person.currentAge);

        // best projection is results?.results[2]
        const best =
          results && results.results && results.results.length === 3
            ? results.results[2]
            : null;

        const showExpenseHighlight =
          best &&
          best.totalRetirementExpense > 0 &&
          best.expenseYears > 0 &&
          best.monthlyExpense > 0;

        return (
          <>
            <div className="card" aria-label={title}>
              <h3 style={{ margin: 0 }}>{title}</h3>

              <div className="form-row">
                <table>
                  <tr>
                    <td>
                      {" "}
                      <div className="label">Current age</div>
                    </td>
                    <td>
                      {" "}
                      <div className="control" style={{ maxWidth: 80 }}>
                        <input
                          type="number"
                          min="0"
                          placeholder="45"
                          value={person.currentAge}
                          onChange={(e) =>
                            setField("currentAge", e.target.value)
                          }
                        />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div className="label">Retirement age</div>
                    </td>

                    <td>
                      {" "}
                      <div className="control" style={{ maxWidth: 80 }}>
                        <input
                          type="number"
                          min={toNum(person.currentAge) + 1}
                          placeholder="65"
                          value={person.retirementAge}
                          onChange={(e) =>
                            setField("retirementAge", e.target.value)
                          }
                        />
                      </div>
                    </td>
                  </tr>
                </table>
                <div>
                  {showYears && (
                    <span className="small" style={{ paddingLeft: 12 }}>
                      <h4 className="small">
                        Years:
                        <b>
                          {toNum(person.retirementAge) -
                            toNum(person.currentAge)}
                        </b>{" "}
                      </h4>
                    </span>
                  )}
                </div>
              </div>

              {!showYears && person.currentAge && person.retirementAge && (
                <div
                  className="small muted"
                  style={{ marginBottom: 3, color: "red" }}
                >
                  Retirement age should be greater than current age.
                </div>
              )}

              <h4 className="small">Work Pension</h4>
              <div className="form-row compact card">
                <div className="label">Current balance</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.retirement.initial}
                    onChange={(e) =>
                      setField("retirement.initial", e.target.value)
                    }
                  />
                </div>
                <div className="label">Annual contribution</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.retirement.annual}
                    onChange={(e) =>
                      setField("retirement.annual", e.target.value)
                    }
                  />
                </div>
              </div>

              <h4 className="small">ISA</h4>
              <div className="form-row compact card">
                <div className="label">Current balance</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.isa.initial}
                    onChange={(e) => setField("isa.initial", e.target.value)}
                  />
                </div>
                <div className="label">Annual contribution</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.isa.annual}
                    onChange={(e) => setField("isa.annual", e.target.value)}
                  />
                </div>
              </div>

              <h4 className="small">SIPP</h4>
              <div className="form-row compact card">
                <div className="label">Current balance</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.sipp.initial}
                    onChange={(e) => setField("sipp.initial", e.target.value)}
                  />
                </div>
                <div className="label">Annual contribution</div>
                <div className="control">
                  <input
                    type="text"
                    inputMode="decimal"
                    placeholder="0.00"
                    value={person.sipp.annual}
                    onChange={(e) => setField("sipp.annual", e.target.value)}
                  />
                </div>

                <h4 className="small">Retirement Expense</h4>
                <div className="form-row compact card">
                  <div className="label">Monthly expected expense</div>
                  <div className="control">
                    <input
                      type="text"
                      inputMode="decimal"
                      placeholder="1200"
                      value={person.retirementMonthlyExpense}
                      onChange={(e) =>
                        setField("retirementMonthlyExpense", e.target.value)
                      }
                    />
                  </div>
                  <div className="label">No. of years</div>
                  <div className="control">
                    <input
                      type="number"
                      min="1"
                      placeholder="25"
                      value={person.retirementExpenseYears}
                      onChange={(e) =>
                        setField("retirementExpenseYears", e.target.value)
                      }
                    />
                  </div>

                  {/* State Pension Note - Inserted directly below Retirement Expense */}
                  <StatePensionNote />
                </div>
              </div>

              <div className="row" style={{ marginTop: 8 }}>
                <button
                  onClick={() => {
                    if (
                      toNum(person.retirementAge) > toNum(person.currentAge)
                    ) {
                      onCalculate();
                    }
                  }}
                >
                  Calculate
                </button>
                <button
                  className="secondary"
                  onClick={() =>
                    onChange(JSON.parse(JSON.stringify(emptyPerson)))
                  }
                  type="button"
                >
                  Reset person
                </button>
              </div>

              {results && (
                <div className="person-results" aria-live="polite">
                  <div style={{ fontSize: 12, color: "var(--muted)" }}>
                    Projections for <strong>{results.years}</strong> years
                  </div>
                  {results.results.map((r) => (
                    <div className="person-result-item" key={r.rate}>
                      <div className="rate">
                        {(r.rate * 100).toFixed(0)}% projection
                      </div>
                      <div className="grid">
                        <div className="label">Retirement</div>
                        <div className="value">
                          £{(r.retirementFV || 0).toLocaleString()}
                        </div>
                        <div className="label">ISA</div>
                        <div className="value">
                          £{(r.isaFV || 0).toLocaleString()}
                        </div>
                        <div className="label">SIPP</div>
                        <div className="value">
                          £{(r.sippFV || 0).toLocaleString()}
                        </div>
                      </div>
                      <div className="total">
                        <div className="label">Total</div>
                        <div className="value">
                          £{(r.total || 0).toLocaleString()}
                        </div>
                      </div>
                      {r.monthlyExpense > 0 && r.expenseYears > 0 && (
                        <>
                          <div className="extra-expense-row">
                            <span>
                              Retirement expense needed
                              <br />
                              (£{Money({ value: r.monthlyExpense })} × 12 ×{" "}
                              {r.expenseYears} years)
                            </span>
                            <span>
                              £{Money({ value: r.totalRetirementExpense })}
                            </span>
                          </div>
                          <div className="extra-expense-row">
                            <span>
                              {r.leftOver >= 0 ? "Left over" : "Shortfall"}
                            </span>
                            <span
                              className={
                                r.leftOver >= 0
                                  ? "leftover-positive"
                                  : "leftover-negative"
                              }
                            >
                              £{Money({ value: r.leftOver })}
                            </span>
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
            {showExpenseHighlight && (
              <div className="retirement-expense-highlights">
                <div className="expense-row">
                  <span className="expense-label">
                    Retirement expense needed
                  </span>
                  <span className="expense-value">
                    £{(best.totalRetirementExpense || 0).toLocaleString()}
                  </span>
                </div>
                <div className="expense-row">
                  <span className="leftover-label">
                    {best.leftOver >= 0 ? "Left over" : "Shortfall"}
                  </span>
                  <span
                    className={`leftover-value ${
                      best.leftOver >= 0
                        ? "leftover-positive"
                        : "leftover-negative"
                    }`}
                  >
                    £
                    {Math.abs(best.leftOver || 0).toLocaleString(undefined, {
                      minimumFractionDigits: 2,
                      maximumFractionDigits: 2,
                    })}
                  </span>
                </div>
              </div>
            )}
          </>
        );
      }

      function App() {
        const rates = [0.04, 0.06, 0.08];

        const [person1, setPerson1] = useState(
          JSON.parse(JSON.stringify(emptyPerson))
        );
        const [person2, setPerson2] = useState(
          JSON.parse(JSON.stringify(emptyPerson))
        );
        const [hasPartner, setHasPartner] = useState(false);

        const [res1, setRes1] = useState(null);
        const [res2, setRes2] = useState(null);
        const [combined, setCombined] = useState(null);

        function calc1() {
          const r = calculatePerson(person1, rates);
          setRes1(r);
          setCombined(null);
        }

        function calc2() {
          const r = calculatePerson(person2, rates);
          setRes2(r);
          setCombined(null);
        }

        function totalBoth() {
          const a = res1 || calculatePerson(person1, rates);
          const b = res2 || calculatePerson(person2, rates);
          const summed = a.results.map((ar, idx) => {
            const br = b.results[idx];
            return {
              rate: ar.rate,
              retirementFV: ar.retirementFV + br.retirementFV,
              isaFV: ar.isaFV + br.isaFV,
              sippFV: ar.sippFV + br.sippFV,
              total: ar.total + br.total,
              totalRetirementExpense:
                ar.totalRetirementExpense + br.totalRetirementExpense,
              leftOver: ar.leftOver + br.leftOver,
            };
          });
          setCombined({ years: `${a.years} / ${b.years}`, results: summed });
        }

        // For combined highlight: show only if both p1 and p2 have valid entries and both results exist
        const showCombinedHighlight =
          combined &&
          combined.results &&
          combined.results.length === 3 &&
          (combined.results[2].totalRetirementExpense > 0 ||
            combined.results[2].leftOver !== undefined);

        return (
          <div className="layout">
            <div>
              <PersonForm
                title="Person 1"
                person={person1}
                onChange={setPerson1}
                onCalculate={calc1}
                results={res1}
              />

              <div style={{ marginTop: 12 }} className="card">
                <h3 style={{ margin: 0 }}>Partner</h3>
                <div className="checkbox-inline">
                  <input
                    id="partner"
                    type="checkbox"
                    checked={hasPartner}
                    onChange={(e) => setHasPartner(e.target.checked)}
                  />
                  <label
                    htmlFor="partner"
                    className="muted"
                    style={{ margin: 0 }}
                  >
                    Add partner
                  </label>
                </div>

                {!hasPartner ? (
                  <p className="muted" style={{ marginTop: 8 }}>
                    Partner not added. Toggle the checkbox to add a partner.
                  </p>
                ) : (
                  <div style={{ marginTop: 8 }}>
                    <PersonForm
                      title="Person 2"
                      person={person2}
                      onChange={setPerson2}
                      onCalculate={calc2}
                      results={res2}
                    />
                  </div>
                )}
              </div>
            </div>

            <aside>
              <div className="card">
                <h3 style={{ margin: 0 }}>Totals</h3>

                <div className="row" style={{ marginTop: 8 }}>
                  <button onClick={totalBoth} disabled={!hasPartner}>
                    Total Both People
                  </button>
                  <button
                    className="secondary"
                    onClick={() => {
                      setPerson1(JSON.parse(JSON.stringify(emptyPerson)));
                      setPerson2(JSON.parse(JSON.stringify(emptyPerson)));
                      setRes1(null);
                      setRes2(null);
                      setCombined(null);
                      setHasPartner(false);
                    }}
                  >
                    Reset All
                  </button>
                </div>

                {!hasPartner && (
                  <p className="muted" style={{ marginTop: 8 }}>
                    Add partner to enable the combined total.
                  </p>
                )}

                {combined && (
                  <>
                    <div className="combined-list" aria-live="polite">
                      <div style={{ fontSize: 12, color: "var(--muted)" }}>
                        Combined totals{" "}
                        <span
                          style={{ color: "var(--muted)", fontWeight: 600 }}
                        >
                          ({combined.years})
                        </span>
                      </div>

                      {combined.results.map((r) => (
                        <div className="combined-item" key={r.rate}>
                          <div className="rate">
                            {(r.rate * 100).toFixed(0)}% projection
                          </div>
                          <div className="row-grid" style={{ marginBottom: 2 }}>
                            <div className="label">Retirement</div>
                            <div className="value">
                              £{(r.retirementFV || 0).toLocaleString()}
                            </div>
                            <div className="label">ISA</div>
                            <div className="value">
                              £{(r.isaFV || 0).toLocaleString()}
                            </div>
                            <div className="label">SIPP</div>
                            <div className="value">
                              £{(r.sippFV || 0).toLocaleString()}
                            </div>
                          </div>
                          <div className="total-value">
                            <div className="label">Total</div>
                            <div className="value total-value-number">
                              £{(r.total || 0).toLocaleString()}
                            </div>
                          </div>
                          {r.totalRetirementExpense > 0 && (
                            <div className="extra-expense-row">
                              <span>Combined retirement expense needed</span>
                              <span>
                                £
                                {(
                                  r.totalRetirementExpense || 0
                                ).toLocaleString()}
                              </span>
                            </div>
                          )}
                          {r.totalRetirementExpense > 0 && (
                            <div className="extra-expense-row">
                              <span>
                                {r.leftOver >= 0 ? "Left over" : "Shortfall"}
                              </span>
                              <span
                                className={
                                  r.leftOver >= 0
                                    ? "leftover-positive"
                                    : "leftover-negative"
                                }
                              >
                                £
                                {(r.leftOver || 0).toLocaleString(undefined, {
                                  minimumFractionDigits: 2,
                                  maximumFractionDigits: 2,
                                })}
                              </span>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                    {showCombinedHighlight && (
                      <div className="retirement-expense-highlights">
                        <div className="expense-row">
                          <span className="expense-label">
                            Combined retirement expense needed
                          </span>
                          <span className="expense-value">
                            £
                            {(
                              combined.results[2].totalRetirementExpense || 0
                            ).toLocaleString()}
                          </span>
                        </div>
                        <div className="expense-row">
                          <span className="leftover-label">
                            {combined.results[2].leftOver >= 0
                              ? "Left over"
                              : "Shortfall"}
                          </span>
                          <span
                            className={`leftover-value ${
                              combined.results[2].leftOver >= 0
                                ? "leftover-positive"
                                : "leftover-negative"
                            }`}
                          >
                            £
                            {Math.abs(
                              combined.results[2].leftOver || 0
                            ).toLocaleString(undefined, {
                              minimumFractionDigits: 2,
                              maximumFractionDigits: 2,
                            })}
                          </span>
                        </div>
                      </div>
                    )}
                  </>
                )}
              </div>
            </aside>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
